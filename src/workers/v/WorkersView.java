/*
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
 */
package workers.v;

import core.c.ErrorHandler;
import core.c.Reloadable;
import core.c.TablePagination;
import core.c.ViewManager;
import core.v.MainMenuView;
import core.v.PaginationPanel;
import java.sql.SQLException;
import java.util.LinkedList;
import java.util.List;
import java.util.logging.Level;
import java.util.logging.Logger;
import javax.swing.JPanel;
import javax.swing.table.DefaultTableModel;
import javax.swing.table.TableModel;
import workers.c.WorkersService;
import workers.m.Worker;

/**
 *
 * @author Zjamnik
 */
public class WorkersView extends JPanel implements Reloadable {
	public static final int ROWS_PER_PAGE = 20;
	public static final String[] COLUMN_NAMES = {
		"Imię",
		"Nazwisko",
		"Stanowisko"
	};
	private TablePagination<Worker> _pagination;

	/**
	 * Creates new form WorkersView
	 */
	public WorkersView() {
		_pagination = new TablePagination<>(new LinkedList<Worker>(), ROWS_PER_PAGE);
		initComponents();
		reload();
		_navPanel.setButtonsListener(new PaginationPanel.ButtonsListener() {
			@Override
			public void nextButtonClicked() {
				_workersTable.setModel(getTableModel(_pagination.getNextPage()));
				_navPanel.setCurrentPage(_pagination.getCurrentPage());
			}

			@Override
			public void previousButtonClicked() {
				_workersTable.setModel(getTableModel(_pagination.getPreviousPage()));
				_navPanel.setCurrentPage(_pagination.getCurrentPage());
			}

			@Override
			public void firstButtonClicked() {
				_workersTable.setModel(getTableModel(_pagination.getFirstPage()));
				_navPanel.setCurrentPage(_pagination.getCurrentPage());
			}

			@Override
			public void lastButtonClicked() {
				_workersTable.setModel(getTableModel(_pagination.getLastPage()));
				_navPanel.setCurrentPage(_pagination.getCurrentPage());
			}
		});
	}

	public TableModel getTableModel(List<Worker> workers) {
		Object[][] data = new Object[workers.size()][];
		for (int i = 0; i < workers.size(); ++i) {
			Worker worker = workers.get(i);
			data[i] = new Object[3];
			data[i][0] = worker.getName();
			data[i][1] = worker.getSurname();
			data[i][2] = worker.getJob();
		}
		return new DefaultTableModel(data, COLUMN_NAMES) {
			@Override
			public boolean isCellEditable(int row, int column) {
				return false;
			}
		};
	}

	@Override
	public final void reload() {
		try {
			_pagination.setTableData(WorkersService.getInstance().getWorkers());
			_workersTable.setModel(getTableModel(_pagination.getCurrentPageData()));
			_navPanel.setCurrentPage(_pagination.getCurrentPage());
			_navPanel.setPageCount(_pagination.getPageCount());
		}
		catch (SQLException ex) {
			ErrorHandler.getInstance().reportError(ex);
		}
	}

	/**
	 * This method is called from within the constructor to initialize the form.
	 * WARNING: Do NOT modify this code. The content of this method is always
	 * regenerated by the Form Editor.
	 */
	@SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        _optionPanel = new javax.swing.JPanel();
        _backButton = new javax.swing.JButton();
        _addWorkerButton = new javax.swing.JButton();
        _editWorkerButton = new javax.swing.JButton();
        _removeWorkerButton = new javax.swing.JButton();
        _tablePanel = new javax.swing.JPanel();
        _tableScrollPanel = new javax.swing.JScrollPane();
        _workersTable = new javax.swing.JTable();
        _workersTable.setColumnSelectionAllowed(false);
        _workersTable.setShowVerticalLines(false);
        _navPanel = new core.v.PaginationPanel();

        _optionPanel.setBorder(javax.swing.BorderFactory.createEtchedBorder());

        _backButton.setText("Wstecz");
        _backButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                _backButtonActionPerformed(evt);
            }
        });

        _addWorkerButton.setText("Dodaj pracownika");

        _editWorkerButton.setText("Edytuj pracownika");
        _editWorkerButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                _editWorkerButtonActionPerformed(evt);
            }
        });

        _removeWorkerButton.setText("Usuń pracownika");

        javax.swing.GroupLayout _optionPanelLayout = new javax.swing.GroupLayout(_optionPanel);
        _optionPanel.setLayout(_optionPanelLayout);
        _optionPanelLayout.setHorizontalGroup(
            _optionPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(_optionPanelLayout.createSequentialGroup()
                .addContainerGap()
                .addComponent(_backButton)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addComponent(_removeWorkerButton)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(_editWorkerButton)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(_addWorkerButton)
                .addContainerGap())
        );
        _optionPanelLayout.setVerticalGroup(
            _optionPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, _optionPanelLayout.createSequentialGroup()
                .addContainerGap()
                .addGroup(_optionPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(_backButton, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addComponent(_addWorkerButton)
                    .addComponent(_editWorkerButton)
                    .addComponent(_removeWorkerButton))
                .addContainerGap())
        );

        _tablePanel.setBorder(javax.swing.BorderFactory.createEtchedBorder());

        _workersTable.setModel(getTableModel(_pagination.getCurrentPageData()));
        _tableScrollPanel.setViewportView(_workersTable);

        javax.swing.GroupLayout _tablePanelLayout = new javax.swing.GroupLayout(_tablePanel);
        _tablePanel.setLayout(_tablePanelLayout);
        _tablePanelLayout.setHorizontalGroup(
            _tablePanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(_tablePanelLayout.createSequentialGroup()
                .addContainerGap()
                .addGroup(_tablePanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(_tableScrollPanel, javax.swing.GroupLayout.DEFAULT_SIZE, 538, Short.MAX_VALUE)
                    .addComponent(_navPanel, javax.swing.GroupLayout.Alignment.TRAILING, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                .addContainerGap())
        );
        _tablePanelLayout.setVerticalGroup(
            _tablePanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(_tablePanelLayout.createSequentialGroup()
                .addContainerGap()
                .addComponent(_tableScrollPanel, javax.swing.GroupLayout.DEFAULT_SIZE, 332, Short.MAX_VALUE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(_navPanel, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap())
        );

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(this);
        this.setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(_optionPanel, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addComponent(_tablePanel, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                .addContainerGap())
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(_tablePanel, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(_optionPanel, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap())
        );
    }// </editor-fold>//GEN-END:initComponents

    private void _backButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event__backButtonActionPerformed
		ViewManager.getInstance().openView(new MainMenuView());
    }//GEN-LAST:event__backButtonActionPerformed

    private void _editWorkerButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event__editWorkerButtonActionPerformed
		if (_workersTable.getSelectedRow() >= 0) {
			try {
				Worker worker = WorkersService.getInstance().getWorker(_pagination.getCurrentPageData().get(_workersTable.getSelectedRow()).getId());
				ViewManager.getInstance().showDialog(new EditWorkerView(ViewManager.getInstance().getMainWindow(), true, this, worker));
			}
			catch (SQLException ex) {
				Logger.getLogger(WorkersView.class.getName()).log(Level.SEVERE, null, ex);
			}
		}
    }//GEN-LAST:event__editWorkerButtonActionPerformed
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton _addWorkerButton;
    private javax.swing.JButton _backButton;
    private javax.swing.JButton _editWorkerButton;
    private core.v.PaginationPanel _navPanel;
    private javax.swing.JPanel _optionPanel;
    private javax.swing.JButton _removeWorkerButton;
    private javax.swing.JPanel _tablePanel;
    private javax.swing.JScrollPane _tableScrollPanel;
    private javax.swing.JTable _workersTable;
    // End of variables declaration//GEN-END:variables
}
